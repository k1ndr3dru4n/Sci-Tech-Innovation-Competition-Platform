# 大学科创竞赛校级管理平台

一个基于 Flask 的 Web 应用，用于支持中国国际大学生创新大赛"青年红色筑梦之旅"赛道、"挑战杯"全国大学生课外学术科技作品竞赛、"挑战杯"中国大学生创业计划大赛的校内组织流程。

## 功能特性

### 核心功能

- **多角色用户系统**
  - 学生：创建项目、填写项目信息、添加队员和指导老师、提交项目
  - 学院管理员：审核本院项目、通过/不通过、填写备注、查看学生信息
  - 校级管理员：审核管理、分配评委、管理决赛流程、自动抽签、设置奖项、数据导出
  - 校外评委：浏览项目材料、在线打分

- **项目管理系统**
  - 多步骤项目创建流程（选择竞赛 → 填写项目信息 → 添加队员和指导老师）
  - 队员确认机制（所有队员确认后才能提交）
  - 多级审核流程（草稿 → 已提交 → 学院审核 → 校级审核）
  - 动态审核状态流转
  - 项目重新提交（学院审核不通过后可修改重新提交）

- **评审系统**
  - 评委分配（多对多关系：评委-项目）
  - 在线打分（支持多维度评分）
  - AJAX 驱动的实时打分界面
  - 评分数据统计

- **筛选与查询**
  - 按项目名称、赛道、学院、审核状态等条件筛选
  - 多条件组合查询
  - 学院管理员可查询本学院学生信息

- **电子证书生成**
  - 自动生成以"项目名+奖项名称"命名的电子奖状（PNG格式）
  - 支持自定义证书模板

- **数据导出**
  - 一键导出项目数据为 Excel
  - 一键导出评分数据为 Excel
  - 支持 CSV 格式导出

### 技术特性

- **多对多数据库关系**
  - 项目-赛道（一个项目可以参加多个赛道）
  - 学生-项目（一个学生可以参与多个项目，一个项目可以有多个成员）
  - 评委-项目（一个评委可以评审多个项目，一个项目可以被多个评委评审）

- **用户认证与权限系统**
  - 基于 Flask-Login 的会话管理
  - 基于角色的访问控制（RBAC）
  - 数据隔离与操作安全

- **前端特性**
  - 响应式设计（支持移动端）
  - 蓝色主题
  - WCAG 无障碍标准（语义化 HTML、足够对比度、键盘可导航）
  - 现代化 UI 设计

## 技术栈

- **后端**: Python 3.8+, Flask 3.0
- **数据库**: SQLite（可切换为 PostgreSQL/MySQL）
- **ORM**: SQLAlchemy
- **前端**: HTML5, CSS3, JavaScript (原生)
- **其他**: Pillow (图像处理), pandas (数据处理), openpyxl (Excel 导出)

## 安装与运行

### 1. 克隆项目

```bash
git clone <repository-url>
cd STIC
```

### 2. 创建虚拟环境（推荐）

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. 安装依赖

```bash
pip install -r requirements.txt
```

### 4. 初始化数据库

```bash
python init_db.py
```

这将创建：
- 数据库表结构
- 三个竞赛及其赛道
- 四个测试账户（学生、学院管理员、校级管理员、校外专家）

**注意**：所有账户的初始密码统一为 `swjtu12345`，系统已禁用注册功能。

### 5. 运行应用

```bash
python app.py
```

应用将在 `http://127.0.0.1:5000` 启动。

## 测试账户

初始化脚本已创建以下测试账户，可直接使用：

### 校内用户（使用学工号登录）

| 角色 | 学工号 | 密码 | 说明 |
|------|--------|------|------|
| 学生 | 2023115871 | swjtu12345 | 测试学生账户 |
| 学院管理员 | T2023115871 | swjtu12345 | 计算机学院管理员 |
| 校级管理员 | A2023115871 | swjtu12345 | 校级管理员 |

### 校外专家（使用用户名/邮箱登录）

| 角色 | 用户名/邮箱 | 密码 |
|------|------------|------|
| 校外专家 | J2023115871 或 judge@example.com | swjtu12345 |

**登录入口**：
- 校内用户：`/auth/login`（使用学工号登录）
- 校外专家：`/auth/judge/login`（使用用户名或邮箱登录）

**注意**：
- 所有账户初始密码统一为：`swjtu12345`
- 系统已禁用注册功能，账户由管理员统一管理
- 如需创建新账户，请通过数据库直接添加

## 项目结构

```
STIC/
├── app.py                 # Flask 应用主文件
├── config.py              # 配置文件
├── models.py              # 数据库模型
├── forms.py               # 表单定义
├── requirements.txt       # Python 依赖
├── init_db.py            # 数据库初始化脚本
├── README.md             # 项目说明
├── routes/               # 路由模块
│   ├── auth.py          # 认证路由
│   ├── dashboard.py     # 仪表板路由
│   ├── student.py       # 学生端路由
│   ├── college_admin.py # 学院管理员路由
│   ├── school_admin.py  # 校级管理员路由
│   └── judge.py         # 评委路由
├── templates/            # HTML 模板
│   ├── base.html        # 基础模板
│   ├── auth/            # 认证相关模板
│   ├── student/         # 学生端模板
│   ├── college_admin/   # 学院管理员模板
│   ├── school_admin/    # 校级管理员模板
│   └── judge/           # 评委模板
├── static/              # 静态文件
│   └── css/
│       └── style.css   # 主样式表
├── utils/               # 工具模块
│   ├── decorators.py   # 权限装饰器
│   ├── certificate.py  # 证书生成
│   └── export.py       # 数据导出
├── routes/             # 路由模块
│   └── profile.py      # 个人资料路由
├── templates/          # HTML 模板
│   └── includes/       # 公共模板组件
│       └── sidebar.html # 侧边栏组件
└── certificates/       # 证书目录（自动创建）
```

## 使用说明

### 学生端

1. **登录**: 使用学工号登录系统
2. **创建项目**: 
   - 第一步：选择要参加的竞赛（中国国际大学生创新大赛"青年红色筑梦之旅"赛道、"挑战杯"全国大学生课外学术科技作品竞赛、"挑战杯"中国大学生创业计划大赛）
   - 第二步：填写项目基本信息（项目名称、项目组别、作品推送学院、项目简介）
   - 第三步：添加队员信息（姓名、学号、学院、专业、联系方式、邮箱）和指导老师信息（姓名、学工号、单位、联系方式）
3. **队员确认**: 所有队员登录账号确认参与后，项目才能提交
4. **提交项目**: 从草稿状态提交，等待学院审核
5. **查看项目**: 查看自己参与的所有项目（包括作为队长创建的项目和受邀参与的项目）

### 学院管理员

1. **审核管理**: 查看本院待审核的项目列表
2. **审核项目**: 查看项目详情，选择"通过"或"不通过"，填写备注说明
3. **项目列表**: 查看本院所有项目，支持按项目名称、赛道、状态筛选
4. **学生信息**: 查询本学院的学生信息，支持按姓名、学工号搜索

### 校级管理员

1. **审核管理**: 查看所有已通过学院审核的项目
2. **项目列表**: 查看所有项目，支持多条件筛选
3. **分配评委**: 为项目分配校外评委
4. **决赛管理**: 进行自动抽签，决定答辩顺序
5. **设置奖项**: 为项目设置奖项，自动生成电子证书
6. **数据导出**: 导出项目数据和评分数据

### 校外评委

1. **查看分配项目**: 查看分配给自己的项目列表
2. **浏览项目材料**: 查看项目详情和相关信息
3. **在线打分**: 填写多维度评分和评语

## 开发说明

### 数据库关系图

```
User (用户)
  ├── TeamMember (多对多: 学生-队伍)
  ├── ProjectMember (多对多: 学生-项目，包含确认状态)
  └── JudgeAssignment (多对多: 评委-项目)

Team (队伍)
  ├── TeamMember (成员)
  └── Project (项目)

Project (项目)
  ├── ProjectTrack (多对多: 项目-赛道)
  ├── ProjectMember (项目成员，包含详细信息)
  ├── JudgeAssignment (评委分配)
  ├── Score (评分)
  └── Award (奖项)

Competition (竞赛)
  ├── Track (赛道)
  └── Project (项目)
```

### 审核状态流转

```
草稿 (DRAFT)
  ↓ [提交]
已提交 (SUBMITTED) - 学院审核中
  ↓ [学院审核通过]
学院已通过 (COLLEGE_APPROVED) - 学校审核中
  ↓ [学校审核通过]
最终通过 (FINAL_APPROVED)
  ↓ [学校审核不通过]
学校审核不通过 (FINAL_REJECTED)

已提交 (SUBMITTED)
  ↓ [学院审核不通过]
学院审核不通过 (COLLEGE_REJECTED)
  ↓ [修改后重新提交]
已提交 (SUBMITTED) - 重新进入审核流程
```

### 扩展开发

- **添加新角色**: 在 `models.py` 的 `UserRole` 类中添加，创建对应的路由和模板
- **添加新字段**: 修改模型，运行数据库迁移
- **自定义证书模板**: 修改 `utils/certificate.py` 中的 `generate_certificate` 函数
- **添加新筛选条件**: 在 `FilterForm` 中添加字段，在路由中实现筛选逻辑

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提交 Issue 和 Pull Request。

