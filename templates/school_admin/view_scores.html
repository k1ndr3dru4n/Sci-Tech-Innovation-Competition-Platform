{% extends "base.html" %}

{% block title %}专家评分详情 - 校级管理员{% endblock %}

{% block content %}
<div class="page-header">
    <h1>专家评分详情</h1>
    <a href="javascript:history.back()" class="btn btn-secondary">返回</a>
</div>

<div class="card">
    <div class="card-header">
        <h2>项目信息</h2>
    </div>
    <div class="card-body">
        <div class="detail-row">
            <span class="detail-label">项目名称</span>
            <span class="detail-value">{{ project.title }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">竞赛名称</span>
            <span class="detail-value">{{ project.competition.name }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">队长</span>
            <span class="detail-value">{{ project.team.leader.real_name }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">学院</span>
            <span class="detail-value">{{ project.team.leader.college or '未设置' }}</span>
        </div>
        {% if project.project_category %}
        <div class="detail-row">
            <span class="detail-label">项目组别</span>
            <span class="detail-value">{{ project.project_category }}</span>
        </div>
        {% endif %}
        {% if project.project_type %}
        <div class="detail-row">
            <span class="detail-label">作品类别</span>
            <span class="detail-value">{{ project.project_type }}</span>
        </div>
        {% endif %}
        {% if project.project_field %}
        <div class="detail-row">
            <span class="detail-label">项目领域</span>
            <span class="detail-value">{{ project.project_field }}</span>
        </div>
        {% endif %}
        {% if project.push_college %}
        <div class="detail-row">
            <span class="detail-label">作品推送学院</span>
            <span class="detail-value">{{ project.push_college }}</span>
        </div>
        {% endif %}
        <div class="detail-row">
            <span class="detail-label">项目简介</span>
            <span class="detail-value" style="white-space: pre-wrap;">{{ project.description }}</span>
        </div>
        {% if project.innovation_points or project.development_status or project.awards_patents_papers %}
        {% if project.innovation_points %}
        <div class="detail-row">
            <span class="detail-label">项目创新点</span>
            <span class="detail-value" style="white-space: pre-wrap;">{{ project.innovation_points }}</span>
        </div>
        {% endif %}
        {% if project.development_status %}
        <div class="detail-row">
            <span class="detail-label">项目开发现状</span>
            <span class="detail-value" style="white-space: pre-wrap;">{{ project.development_status }}</span>
        </div>
        {% endif %}
        {% if project.awards_patents_papers %}
        <div class="detail-row">
            <span class="detail-label">获奖、专利及论文情况</span>
            <span class="detail-value" style="white-space: pre-wrap;">{{ project.awards_patents_papers }}</span>
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>

{% if scores %}
<div class="card">
    <div class="card-header">
        <h2>专家评分</h2>
    </div>
    <div class="card-body">
        <div class="table-container" style="overflow-x: auto;">
            <table style="width: 100%; min-width: 800px; border-collapse: separate; border-spacing: 0;">
                <thead>
                    <tr>
                        <th style="padding: 10px; text-align: center; min-width: 60px;">序号</th>
                        <th style="padding: 10px; text-align: center; min-width: 150px;">专家姓名</th>
                        <th style="padding: 10px; text-align: center; min-width: 100px;">评分</th>
                        <th style="padding: 10px; text-align: center; min-width: 400px;">项目意见</th>
                        <th style="padding: 10px; text-align: center; min-width: 140px;">评分时间</th>
                    </tr>
                </thead>
                <tbody>
                    {% for score in scores %}
                    <tr>
                        <td style="white-space: nowrap; padding: 10px; text-align: center;"><strong>{{ loop.index }}</strong></td>
                        <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 10px; text-align: center;" title="{{ score.judge.real_name }}">{{ score.judge.real_name }}</td>
                        <td style="white-space: nowrap; padding: 10px; text-align: center;"><strong>{{ score.score_value }}分</strong></td>
                        <td style="padding: 10px; text-align: left;">{{ score.comment or '无' }}</td>
                        <td style="white-space: nowrap; padding: 10px; text-align: center;">{{ score.scored_at.strftime('%Y-%m-%d %H:%M') if score.scored_at else '未知' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if scores|length > 0 %}
        <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-md); border-top: 1px solid var(--border-color);">
            <div class="detail-row">
                <span class="detail-label">评分专家数量：</span>
                <span class="detail-value"><strong>{{ scores|length }}位</strong></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">平均分：</span>
                <span class="detail-value"><strong>{{ "%.1f"|format((scores|sum(attribute='score_value')) / scores|length) }}分</strong></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">最高分：</span>
                <span class="detail-value"><strong>{{ scores|map(attribute='score_value')|max }}分</strong></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">最低分：</span>
                <span class="detail-value"><strong>{{ scores|map(attribute='score_value')|min }}分</strong></span>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body">
        <div class="empty-state">
            <p>该项目暂无专家评分</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

